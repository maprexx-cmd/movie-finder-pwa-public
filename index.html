<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Movie Finder</title>

  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#1C1630">
  <link rel="apple-touch-icon" href="icon-192.png">

  <style>
    /* === STILI INVARIATI === */
    :root{
      --bg:#0E0B1A;
      --text:#FFFFFF;
      --muted:#BDB7D6;
      --violet:#7c3aed;
      --violet2:#5b21b6;
      --yellow:#F2C94C;
      --border: rgba(255,255,255,.10);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: linear-gradient(180deg, #070516, var(--bg));
      color:var(--text);
      min-height:100vh;
    }
    .wrap{max-width:1040px;margin:0 auto;padding:18px 14px 80px}
    .screen{display:none}
    .screen.active{display:block}
    button{cursor:pointer}
  </style>
</head>

<body>

<div class="wrap">

  <div id="screenStart" class="screen active">
    <h1>Movie Finder</h1>
    <button id="btnGoBasic">Entra in Basic</button>
    <button id="btnGoPremium">Entra in Premium</button>
    <button id="btnExitFromStart">Esci</button>
  </div>

  <div id="screenBasic" class="screen">
    <h2>Basic</h2>
    <div id="basicGenres">
      <label><input type="checkbox" value="azione"> Azione</label>
      <label><input type="checkbox" value="comico"> Comico</label>
      <label><input type="checkbox" value="thriller"> Thriller</label>
      <label><input type="checkbox" value="animazione"> Animazione</label>
    </div>
    <button id="btnBasicSearch">Cerca</button>
    <button id="btnBackFromBasic">Indietro</button>
    <div id="basicResults"></div>
  </div>

  <div id="screenPremium" class="screen">
    <h2>Premium</h2>
    <button id="btnPremiumSearch">Cerca</button>
    <button id="btnBackFromPremium">Indietro</button>
    <div id="premiumResults"></div>
  </div>

</div>

<!-- OVERLAY USCITA -->
<div id="cinema" style="display:none;position:fixed;inset:0;background:#000;color:#fff;align-items:center;justify-content:center;text-align:center">
  <div>
    <p class="cinemaTitle" id="cinemaTitle">Mettiti comodo, lo spettacolo sta per cominciare</p>
    <p class="subtitle" id="cinemaSub">Chiudi la scheda o premi Indietro sul telefono.</p>
    <button id="cinemaExitNow">Chiudi</button>
    <button id="cinemaCancel">Annulla</button>
  </div>
</div>

<script>
(function(){

  /* === PATCH 1: CHIAVE TMDB INSERITA === */
  const TMDB_KEY = "f8ecb75282e8dcea2d4845598cc7d030";

  const TMDB = "https://api.themoviedb.org/3";
  const IMG = "https://image.tmdb.org/t/p/w342";
  const $ = id => document.getElementById(id);

  function show(id){
    document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
    $(id).classList.add("active");
  }

  function genreMap(){
    return { azione:28, comico:35, thriller:53, animazione:16 };
  }

  async function api(path, params){
    const u = new URL(TMDB + path);
    Object.entries(params).forEach(([k,v])=>u.searchParams.set(k,v));
    const r = await fetch(u);
    if(!r.ok) throw new Error(r.status);
    return r.json();
  }

  async function doBasicSearch(){
    const genres = Array.from(document.querySelectorAll("#basicGenres input:checked")).map(x=>genreMap()[x.value]);
    if(!genres.length) return alert("Seleziona almeno un genere");

    const data = await api("/discover/movie", {
      api_key: TMDB_KEY,
      language: "it-IT",
      with_genres: genres.join(","),
      watch_region: "IT",
      include_adult: "false"
    });

    const box = $("basicResults");
    box.innerHTML = "";
    data.results.slice(0,3).forEach(m=>{
      const p = document.createElement("p");
      p.textContent = m.title;
      box.appendChild(p);
    });
  }

  $("btnGoBasic").onclick = ()=>show("screenBasic");
  $("btnGoPremium").onclick = ()=>show("screenPremium");
  $("btnBackFromBasic").onclick = ()=>show("screenStart");
  $("btnBackFromPremium").onclick = ()=>show("screenStart");
  $("btnBasicSearch").onclick = doBasicSearch;

  $("btnExitFromStart").onclick = ()=>$("cinema").style.display="flex";
  $("cinemaCancel").onclick = ()=>$("cinema").style.display="none";
  $("cinemaExitNow").onclick = ()=>window.close();

})();
</script>

</body>
</html>
