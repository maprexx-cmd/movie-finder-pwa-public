<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Movie Finder</title>
<meta name="theme-color" content="#0B0F1A">

<style>
:root{
--bg:#0B0F1A;
--text:#F8FAFC;
--muted:#9CA3AF;
--acidY:#EFFF00;
--acidG:#7CFF00;
--blue:#0047FF;
--card:rgba(255,255,255,.06);
--border:rgba(255,255,255,.12);
}

*{box-sizing:border-box}

body{
margin:0;
font-family:system-ui,-apple-system,Segoe UI,Roboto;
background:var(--bg);
color:var(--text);
}

.app{
max-width:900px;
margin:auto;
padding:16px;
}

h1{
margin:0;
font-size:20px;
}

button{
border:none;
border-radius:18px;
padding:14px;
font-weight:800;
cursor:pointer;
}

.cta{
background:linear-gradient(135deg,var(--acidY),var(--acidG));
color:var(--blue);
width:100%;
margin-top:14px;
}

.ghost{
background:transparent;
border:1px solid var(--border);
color:var(--text);
}

.card{
background:var(--card);
border:1px solid var(--border);
border-radius:22px;
padding:16px;
margin-top:16px;
}

.toggle{
display:flex;
align-items:center;
gap:10px;
margin-top:10px;
}

input[type=checkbox]{
accent-color:var(--acidG);
transform:scale(1.2);
}

.result{
margin-top:16px;
}

.overlay{
position:fixed;
inset:0;
background:black;
color:white;
display:none;
align-items:center;
justify-content:center;
flex-direction:column;
z-index:99;
}

.overlay.show{display:flex}

.small{font-size:13px;color:var(--muted)}
</style>
</head>

<body>

<div class="app">

<div id="welcome" class="card">
<h1>Movie Finder</h1>
<p class="small">Tu scegli il mood. Al film pensiamo noi.</p>

<button class="cta" onclick="goBasic()">Continua gratis</button>
<button class="ghost" onclick="goPremium()">Passa a Premium</button>

<p class="small">Gratis: solo film, 1 ricerca al giorno</p>
</div>

<div id="app" style="display:none">

<div class="card">
<h1>Cosa guardi oggi?</h1>

<div class="toggle">
<input id="comedy" type="checkbox"> Comico
</div>
<div class="toggle">
<input id="action" type="checkbox"> Azione
</div>
<div class="toggle">
<input id="romance" type="checkbox"> Romantico
</div>

<button class="cta" onclick="search()">Cosa guardi oggi?</button>
<p id="limit" class="small"></p>
</div>

<div id="result" class="card result"></div>

</div>
</div>

<div id="exit" class="overlay">
<h2>Sta per iniziare il film</h2>
<p id="exitTitle"></p>
<button class="cta" onclick="closeApp()">Esci dall’app</button>
</div>

<script>
const API="f8ecb75282e8dcea2d4845598cc7d030";
const BASE="https://api.themoviedb.org/3";
let searched=false;
let lastTitle="";

function goBasic(){
localStorage.setItem("mode","basic");
document.getElementById("welcome").style.display="none";
document.getElementById("app").style.display="block";
}

function goPremium(){
localStorage.setItem("mode","premium");
goBasic();
}

async function search(){
if(localStorage.getItem("mode")==="basic" && searched){
document.getElementById("limit").innerText="Hai già cercato oggi";
return;
}

let genres=[];
if(comedy.checked) genres.push(35);
if(action.checked) genres.push(28);
if(romance.checked) genres.push(10749);

if(genres.length===0){
alert("Seleziona almeno un genere");
return;
}

let url=`${BASE}/discover/movie?api_key=${API}&with_genres=${genres.join(",")}&watch_region=IT&with_watch_monetization_types=flatrate|rent|buy`;

let r=await fetch(url);
let j=await r.json();
let m=j.results[0];

if(!m){
result.innerHTML="<p class='small'>Nessun risultato</p>";
return;
}

lastTitle=m.title;
searched=true;
result.innerHTML=`
<h3>${m.title}</h3>
<p class="small">${m.overview?.slice(0,150) || ""}</p>
<button class="ghost" onclick="showExit()">Chiudi</button>
`;
}

function showExit(){
exitTitle.innerText=lastTitle;
document.getElementById("exit").classList.add("show");
}

function closeApp(){
window.close();
}
</script>

</body>
</html>
