<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Movie Finder</title>

<style>
:root{
  --bg1:#0f172a;
  --bg2:#020617;
  --card:#0b1220;
  --card2:rgba(255,255,255,0.04);
  --text:#ffffff;
  --muted:rgba(255,255,255,0.74);
  --muted2:rgba(255,255,255,0.58);
  --acidY:#EFFF00;
  --acidG:#7CFF00;
  --blue:#0033cc;
  --border:rgba(255,255,255,0.18);
  --good:rgba(124,255,0,0.18);
  --warn:rgba(239,255,0,0.14);
}

body{
  margin:0;
  font-family:Arial,sans-serif;
  background:radial-gradient(circle at top,var(--bg1),var(--bg2));
  color:var(--text);
}

.container{
  max-width:460px;
  margin:18px auto 40px auto;
  padding:16px;
}

a{
  color:var(--acidY);
  text-decoration:none;
}

.topLink{
  font-size:12px;
  color:var(--muted2);
  margin:0 0 10px 0;
  text-align:center;
}

.card{
  background:var(--card);
  border-radius:18px;
  padding:18px;
  box-shadow:0 0 40px rgba(0,0,0,0.6);
  border:1px solid rgba(255,255,255,0.06);
}

h1{
  font-size:22px;
  margin:0 0 8px 0;
}

h2{
  font-size:18px;
  margin:0 0 10px 0;
}

p{
  margin:8px 0 0 0;
  color:var(--muted);
  line-height:1.35;
}

.small{
  font-size:12px;
  color:var(--muted2);
  margin-top:10px;
  line-height:1.35;
}

.hr{
  height:1px;
  background:rgba(255,255,255,0.10);
  margin:14px 0;
}

.badge{
  display:inline-block;
  margin-top:10px;
  padding:8px 10px;
  border-radius:999px;
  background:rgba(255,255,255,0.08);
  color:var(--muted);
  font-size:12px;
}

.grid2{
  display:grid;
  grid-template-columns:1fr;
  gap:12px;
}

.plan{
  background:var(--card2);
  border:1px solid rgba(255,255,255,0.10);
  border-radius:16px;
  padding:14px;
}

.planTitle{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-bottom:8px;
}

.pill{
  font-size:11px;
  padding:6px 8px;
  border-radius:999px;
  border:1px solid rgba(255,255,255,0.14);
  color:var(--muted);
  background:rgba(255,255,255,0.06);
}

.pill.good{
  border-color:rgba(124,255,0,0.25);
  background:var(--good);
}

.pill.warn{
  border-color:rgba(239,255,0,0.25);
  background:var(--warn);
}

.ul{
  margin:0;
  padding-left:18px;
  color:var(--muted);
  line-height:1.4;
  font-size:14px;
}

.ul li{
  margin:6px 0;
}

button{
  width:100%;
  margin-top:12px;
  padding:15px;
  border-radius:28px;
  border:none;
  background:linear-gradient(90deg,var(--acidY),var(--acidG));
  color:var(--blue);
  font-size:17px;
  font-weight:900;
  cursor:pointer;
}

button:active{
  transform:scale(0.985);
}

.secondary{
  background:transparent;
  border:1px solid var(--border);
  color:#fff;
  font-weight:800;
}

.row{
  display:flex;
  gap:10px;
}

.row button{
  width:50%;
  margin-top:0;
  padding:13px;
  border-radius:18px;
  font-size:14px;
}

.hidden{
  display:none;
}

label{
  display:flex;
  align-items:center;
  margin:10px 0;
  font-size:16px;
}

input[type="checkbox"]{
  margin-right:10px;
  width:20px;
  height:20px;
  accent-color:var(--acidG);
}

.resultWrap{
  margin-top:14px;
}

.result{
  margin-top:12px;
  background:var(--card2);
  border:1px solid rgba(255,255,255,0.10);
  border-radius:18px;
  padding:14px;
}

.posterBox{
  width:100%;
  height:240px;
  border-radius:14px;
  margin-bottom:10px;
  background:#111827;
  display:flex;
  align-items:center;
  justify-content:center;
  overflow:hidden;
  border:1px solid rgba(255,255,255,0.10);
}

.posterBox img{
  width:100%;
  height:100%;
  object-fit:cover;
}

.posterFallback{
  font-size:13px;
  color:var(--muted2);
  padding:14px;
  text-align:center;
}

.actions{
  display:flex;
  gap:10px;
  margin-top:12px;
}

.actions button{
  width:50%;
  padding:12px;
  border-radius:18px;
  font-size:14px;
}

.fade{
  position:fixed;
  inset:0;
  background:black;
  opacity:0;
  pointer-events:none;
  transition:opacity 700ms ease;
  z-index:998;
}

.fade.active{
  opacity:1;
  pointer-events:auto;
}

.overlay{
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  text-align:center;
  z-index:999;
  padding:22px;
}

.overlay.active{
  display:flex;
}

.overlay h2{
  font-size:22px;
  margin:0 0 10px 0;
}

.overlay .filmTitle{
  font-size:18px;
  margin:0 0 14px 0;
  color:var(--acidY);
  font-weight:900;
}

.overlay .hint{
  font-size:12px;
  color:rgba(255,255,255,0.70);
  margin:0 0 14px 0;
  max-width:360px;
  line-height:1.35;
}

.toast{
  position:fixed;
  left:50%;
  bottom:16px;
  transform:translateX(-50%);
  background:rgba(0,0,0,0.72);
  color:#fff;
  border:1px solid rgba(255,255,255,0.14);
  padding:10px 12px;
  border-radius:999px;
  font-size:12px;
  display:none;
  z-index:1000;
  max-width:92vw;
}

/* SPLASH */
.splash{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:radial-gradient(circle at top, rgba(239,255,0,0.10), transparent 60%), radial-gradient(circle at bottom, rgba(124,255,0,0.08), transparent 55%), #050815;
  z-index:2000;
  transition:opacity 500ms ease;
}

.splash.hide{
  opacity:0;
  pointer-events:none;
}

.splashBox{
  width:min(420px, 88vw);
  text-align:center;
  padding:22px 18px;
}

.appIcon{
  width:92px;
  height:92px;
  border-radius:24px;
  margin:0 auto 14px auto;
  background:linear-gradient(135deg,var(--acidY),var(--acidG));
  box-shadow:0 18px 50px rgba(0,0,0,0.55);
  display:flex;
  align-items:center;
  justify-content:center;
}

.appIcon span{
  font-weight:900;
  color:var(--blue);
  font-size:28px;
}

.splashTitle{
  font-size:22px;
  margin:0 0 6px 0;
}

.splashText{
  color:rgba(255,255,255,0.80);
  margin:0;
  font-size:14px;
  line-height:1.35;
}
</style>
</head>

<body>

<div class="splash" id="splash">
  <div class="splashBox">
    <div class="appIcon"><span>MF</span></div>
    <div class="splashTitle">Movie Finder</div>
    <p class="splashText">COSA VUOI GUARDARE OGGI?</p>
  </div>
</div>

<div class="container">

  <p class="topLink">
    App: <a href="https://maprexx-cmd.github.io/movie-finder-pwa-public/" target="_blank" rel="noopener">https://maprexx-cmd.github.io/movie-finder-pwa-public/</a>
  </p>

  <div class="card" id="screenStart">
    <h1>Movie Finder</h1>
    <p>Scegli la versione. Poi premi “Cosa guardi oggi?”.</p>

    <div class="hr"></div>

    <div class="grid2">

      <div class="plan">
        <div class="planTitle">
          <h2 style="margin:0">BASIC</h2>
          <span class="pill good">Gratuita</span>
        </div>

        <ul class="ul">
          <li>Solo film, nessuna serie TV</li>
          <li>Una sola ricerca al giorno, 3 risultati</li>
          <li>Filtri essenziali, comico, azione, romantico, cartoni animati</li>
          <li>Esclusione contenuti VM18</li>
          <li>Disponibilità streaming sulle piattaforme online</li>
          <li>Trama molto breve</li>
          <li>Nessuna registrazione</li>
        </ul>

        <button onclick="startBasic()">Continua BASIC</button>
      </div>

      <div class="plan">
        <div class="planTitle">
          <h2 style="margin:0">PREMIUM</h2>
          <span class="pill warn">A pagamento</span>
        </div>

        <ul class="ul">
          <li>Film e serie TV</li>
          <li>Nessun limite di ricerche</li>
          <li>Tutti i generi e slider 0 a 5 per genere</li>
          <li>Accesso ai contenuti VM18</li>
          <li>Trama estesa e spiegazione più approfondita</li>
          <li>Watchlist sincronizzata con account</li>
          <li>Trending, 5 titoli più visti della settimana</li>
          <li>Condivisione social</li>
        </ul>

        <button class="secondary" onclick="goPremiumInfo()">Passa a PREMIUM</button>
        <p class="small">Qui simuliamo Premium. Nell’app Play Store useremo il pagamento reale.</p>
      </div>

    </div>

    <span class="badge" id="modeBadge">Modalità: non selezionata</span>
  </div>

  <div class="card hidden" id="screenPremiumInfo">
    <h1>Premium</h1>
    <p>In questa versione web non puoi pagare dentro l’app.</p>
    <p>Nell’app Android pubblicata sul Play Store useremo Google Play Billing.</p>
    <div class="hr"></div>
    <button onclick="simulatePremium()">Ho già Premium, continua</button>
    <button class="secondary" onclick="backToStart()">Indietro</button>
  </div>

  <div class="card hidden" id="screenChooser">
    <h1>Cosa guardi oggi?</h1>
    <span class="badge" id="contentBadge">Contenuto: Film</span>

    <div class="hr"></div>

    <label><input type="checkbox" value="35" class="genre">Comico</label>
    <label><input type="checkbox" value="28" class="genre">Azione</label>
    <label><input type="checkbox" value="10749" class="genre">Romantico</label>
    <label><input type="checkbox" value="16" class="genre">Cartoni animati</label>

    <button onclick="findSomething()">Cosa guardi oggi?</button>

    <p class="small" id="limitNote"></p>

    <div class="resultWrap" id="resultsWrap"></div>

    <button class="secondary" onclick="resetAll()">Torna all’inizio</button>
  </div>

</div>

<div class="fade" id="fade"></div>

<div class="overlay" id="overlay">
  <h2>Sta iniziando il film...</h2>
  <div class="filmTitle" id="overlayFilmTitle"></div>
  <p class="hint">Ora chiudi la schermata e avvia la visione dalla tua piattaforma.</p>
  <button onclick="exitApp()">Ok, esci</button>
</div>

<div id="toast" class="toast"></div>

<script>
const TMDB_KEY = "f8ecb75282e8dcea2d4845598cc7d030";
const IMG_BASE = "https://image.tmdb.org/t/p/w500";

const LS_MODE = "mf_mode";
const LS_LAST = "mf_lastSearchDate";
const LS_BASIC_USED = "mf_basic_used_today";

let mode = "none";
let contentType = "movie";
let lastTitle = "";
let lastResultShown = false;

function todayISO(){
  const d=new Date();
  const y=d.getFullYear();
  const m=String(d.getMonth()+1).padStart(2,"0");
  const day=String(d.getDate()).padStart(2,"0");
  return `${y}-${m}-${day}`;
}

function toast(msg){
  const t=document.getElementById("toast");
  t.textContent=msg;
  t.style.display="block";
  clearTimeout(toast._t);
  toast._t=setTimeout(()=>{t.style.display="none";},2200);
}

function showOnly(id){
  ["screenStart","screenPremiumInfo","screenChooser"].forEach(x=>{
    document.getElementById(x).classList.add("hidden");
  });
  document.getElementById(id).classList.remove("hidden");
}

function setBadge(){
  const b=document.getElementById("modeBadge");
  if(mode==="basic") b.textContent="Modalità: BASIC";
  else if(mode==="premium") b.textContent="Modalità: PREMIUM";
  else b.textContent="Modalità: non selezionata";
}

function updateLimitNote(){
  const el=document.getElementById("limitNote");
  if(mode==="basic"){
    const last=localStorage.getItem(LS_LAST)||"";
    if(last===todayISO()){
      el.textContent="Hai già fatto la ricerca di oggi. Riprova domani.";
    }else{
      el.textContent="BASIC. Una ricerca al giorno. Ti mostro 3 risultati.";
    }
  }else{
    el.textContent="PREMIUM. Nessun limite.";
  }
}

function startBasic(){
  mode="basic";
  contentType="movie";
  lastResultShown=false;
  localStorage.setItem(LS_MODE,"basic");
  setBadge();
  document.getElementById("contentBadge").textContent="Contenuto: Film";
  showOnly("screenChooser");
  updateLimitNote();
  clearResults();
}

function goPremiumInfo(){
  showOnly("screenPremiumInfo");
}

function simulatePremium(){
  mode="premium";
  contentType="movie";
  lastResultShown=false;
  localStorage.setItem(LS_MODE,"premium");
  setBadge();
  document.getElementById("contentBadge").textContent="Contenuto: Film";
  showOnly("screenChooser");
  updateLimitNote();
  clearResults();
}

function backToStart(){
  showOnly("screenStart");
}

function getSelectedGenres(){
  return Array.from(document.querySelectorAll(".genre:checked")).map(x=>x.value);
}

function canSearchToday(){
  if(mode!=="basic") return true;
  const last=localStorage.getItem(LS_LAST)||"";
  return last!==todayISO();
}

function markSearchedToday(){
  if(mode!=="basic") return;
  localStorage.setItem(LS_LAST,todayISO());
}

function buildDiscoverUrl(genres){
  const base="https://api.themoviedb.org/3/discover/movie";
  const params=new URLSearchParams();
  params.set("api_key",TMDB_KEY);
  params.set("language","it-IT");
  params.set("sort_by","popularity.desc");
  params.set("include_adult", mode==="premium" ? "true" : "false");
  params.set("with_genres",genres.join(","));
  return base + "?" + params.toString();
}

function pickPoolWithPoster(results){
  const withPoster=results.filter(x=>x && x.poster_path);
  return withPoster.length ? withPoster : results;
}

function shortOverview(text){
  if(!text) return "Trama non disponibile";
  const t=text.trim();
  if(mode!=="basic") return t;
  if(t.length<=140) return t;
  return t.slice(0,140).trim() + "...";
}

function renderPoster(box, posterPath){
  box.innerHTML="";
  if(!posterPath){
    const fb=document.createElement("div");
    fb.className="posterFallback";
    fb.textContent="Locandina non disponibile";
    box.appendChild(fb);
    return;
  }
  const img=document.createElement("img");
  img.alt="Locandina";
  img.onerror=()=>{
    box.innerHTML="";
    const fb=document.createElement("div");
    fb.className="posterFallback";
    fb.textContent="Locandina non disponibile";
    box.appendChild(fb);
  };
  img.src=IMG_BASE + posterPath;
  box.appendChild(img);
}

function clearResults(){
  document.getElementById("resultsWrap").innerHTML="";
  lastResultShown=false;
  lastTitle="";
}

async function findSomething(){
  const genres=getSelectedGenres();
  if(genres.length===0){
    toast("Seleziona almeno un genere");
    return;
  }

  if(!canSearchToday()){
    toast("Hai già cercato oggi. Riprova domani.");
    updateLimitNote();
    return;
  }

  clearResults();

  try{
    const res=await fetch(buildDiscoverUrl(genres));
    const data=await res.json();

    if(!data || !data.results || data.results.length===0){
      toast("Nessun risultato. Cambia selezione.");
      return;
    }

    let pool = pickPoolWithPoster(data.results);

    pool = pool.slice(0, 30);
    pool.sort(()=>Math.random()-0.5);

    const picked = pool.slice(0,3);

    const wrap=document.getElementById("resultsWrap");

    picked.forEach(item=>{
      const title=item.title || "Titolo";
      const card=document.createElement("div");
      card.className="result";

      const posterBox=document.createElement("div");
      posterBox.className="posterBox";
      renderPoster(posterBox, item.poster_path);

      const h=document.createElement("h2");
      h.textContent=title;

      const p=document.createElement("p");
      p.textContent=shortOverview(item.overview);

      const actions=document.createElement("div");
      actions.className="actions";

      const btnBack=document.createElement("button");
      btnBack.className="secondary";
      btnBack.textContent="Indietro";
      btnBack.onclick=()=>{ card.remove(); };

      const btnExit=document.createElement("button");
      btnExit.textContent="Scegli questo";
      btnExit.onclick=()=>{
        lastTitle=title;
        lastResultShown=true;
        startExitEffect();
      };

      actions.appendChild(btnBack);
      actions.appendChild(btnExit);

      card.appendChild(posterBox);
      card.appendChild(h);
      card.appendChild(p);
      card.appendChild(actions);

      wrap.appendChild(card);
    });

    markSearchedToday();
    updateLimitNote();

  }catch(e){
    toast("Errore di rete. Riprova.");
  }
}

function startExitEffect(){
  if(!lastResultShown){
    toast("Seleziona un titolo");
    return;
  }
  document.getElementById("overlayFilmTitle").textContent=lastTitle || "Il tuo film";
  const fade=document.getElementById("fade");
  const overlay=document.getElementById("overlay");

  fade.classList.add("active");
  setTimeout(()=>{ overlay.classList.add("active"); }, 700);
}

function exitApp(){
  const overlay=document.getElementById("overlay");
  overlay.classList.remove("active");

  setTimeout(()=>{
    try{ window.close(); }catch(e){}
    toast("Se non si chiude, chiudi tu la schermata.");
  }, 150);
}

function resetAll(){
  document.querySelectorAll(".genre").forEach(x=>x.checked=false);
  clearResults();
  showOnly("screenStart");
}

(function boot(){
  const splash=document.getElementById("splash");
  setTimeout(()=>{ splash.classList.add("hide"); }, 2000);

  const saved=localStorage.getItem(LS_MODE);
  if(saved==="basic" || saved==="premium"){
    mode=saved;
    setBadge();
  }else{
    setBadge();
  }
})();
</script>

</body>
</html>
