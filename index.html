<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<meta name="theme-color" content="#0b1020">
<title>Movie Finder</title>

<style>
:root{
--bg0:#050813;
--bg1:#0b1020;
--card:#111827;
--line:#1f2937;
--text:#e5e7eb;
--muted:#9ca3af;
--y:#d9ff2f;
--g:#39ff6b;
--blue:#1e40af;
--r:20px;
}
*{box-sizing:border-box}
body{
margin:0;
font-family:system-ui,Arial;
background:linear-gradient(180deg,var(--bg0),var(--bg1));
color:var(--text);
padding:16px;
}
.card{
background:var(--card);
border-radius:var(--r);
padding:18px;
margin-bottom:16px;
border:1px solid var(--line);
}
h1,h2,h3{margin:0 0 10px}
.small{color:var(--muted);font-size:13px;line-height:1.35}
.row{display:flex;gap:10px;flex-wrap:wrap}
.btn{
padding:14px 20px;
border-radius:999px;
border:none;
font-weight:900;
cursor:pointer;
}
.primary{
background:linear-gradient(90deg,var(--y),var(--g));
color:var(--blue);
}
.secondary{
background:transparent;
border:1px solid #374151;
color:#fff;
}
.hidden{display:none}
.genre{margin:10px 0}
input[type=checkbox]{width:20px;height:20px;accent-color:var(--g)}
input[type=range]{width:100%}
.results{margin-top:10px}
.result{
border:1px solid #374151;
border-radius:16px;
padding:10px;
display:grid;
grid-template-columns:90px 1fr;
gap:12px;
margin-bottom:12px;
}
.poster{
width:90px;height:135px;
background:#000;
border-radius:12px;
overflow:hidden;
}
.poster img{width:100%;height:100%;object-fit:cover}

/* SPLASH 2 SECONDI */
.splash{
position:fixed;inset:0;
display:flex;
align-items:center;
justify-content:center;
flex-direction:column;
z-index:300;
background:
radial-gradient(900px 600px at 30% 20%, rgba(217,255,47,.14), transparent 55%),
radial-gradient(900px 600px at 80% 30%, rgba(57,255,107,.12), transparent 55%),
linear-gradient(180deg,var(--bg0),var(--bg1));
transition:opacity .45s ease;
opacity:1;
}
.splash.hide{opacity:0;pointer-events:none}
.splashLogo{
width:92px;height:92px;border-radius:28px;
background:linear-gradient(135deg, rgba(217,255,47,.95), rgba(57,255,107,.85));
display:grid;place-items:center;
color:#0b1020;font-weight:1000;font-size:28px;
box-shadow:0 18px 55px rgba(217,255,47,.16);
margin-bottom:12px;
}
.splashTitle{font-weight:1000;font-size:22px;margin-bottom:6px}
.splashSub{color:var(--muted);font-size:13px}

/* USCITA SFUMATA */
.fadeOut{
position:fixed;inset:0;
display:flex;
align-items:center;
justify-content:center;
flex-direction:column;
z-index:350;
background:#000;
opacity:0;
pointer-events:none;
transition:opacity .75s ease;
padding:20px;
text-align:center;
}
.fadeOut.show{opacity:1;pointer-events:auto}
.fadeText{font-size:22px;font-weight:1000;margin-bottom:14px}
</style>
</head>

<body>

<div class="splash" id="splash">
  <div class="splashLogo">MF</div>
  <div class="splashTitle">Movie Finder</div>
  <div class="splashSub">COSA VUOI GUARDARE OGGI?</div>
</div>

<div class="fadeOut" id="fadeOut">
  <div class="fadeText">Sta iniziando il film...</div>
  <button class="btn primary" id="exitBtn">Esci dalla app</button>
  <div class="small" style="margin-top:10px">Se non si chiude da solo, chiudi tu la scheda.</div>
</div>

<div class="card hidden" id="home">
  <h1>Movie Finder</h1>
  <p class="small">COSA VUOI GUARDARE OGGI?</p>
  <div class="row">
    <button class="btn primary" id="basicGo">BASIC</button>
    <button class="btn secondary" id="premiumGo">PREMIUM</button>
  </div>
</div>

<div class="card hidden" id="basic">
  <h2>BASIC</h2>
  <p class="small">1 ricerca al giorno, 3 film</p>

  <div class="genre"><label><input type="checkbox" value="35"> Comico</label></div>
  <div class="genre"><label><input type="checkbox" value="28"> Azione</label></div>
  <div class="genre"><label><input type="checkbox" value="10749"> Romantico</label></div>
  <div class="genre"><label><input type="checkbox" value="16"> Cartoni animati</label></div>

  <div class="row">
    <button class="btn primary" id="basicSearch">Trova film</button>
    <button class="btn secondary" id="homeFromBasic">Home</button>
  </div>

  <div class="small" id="basicMsg" style="margin-top:10px"></div>
</div>

<div class="card hidden" id="premium">
  <h2>PREMIUM</h2>
  <p class="small">Demo Premium attiva. Trending separato. Slider base.</p>

  <div class="row">
    <button class="btn primary" id="typeMovie">Film</button>
    <button class="btn primary" id="typeTv">Serie TV</button>
  </div>

  <h3 style="margin-top:12px">Preferenze</h3>
  <div class="genre">Comico <input type="range" min="0" max="5" value="0" data-g="35"></div>
  <div class="genre">Azione <input type="range" min="0" max="5" value="0" data-g="28"></div>
  <div class="genre">Romantico <input type="range" min="0" max="5" value="0" data-g="10749"></div>
  <div class="genre">Animazione <input type="range" min="0" max="5" value="0" data-g="16"></div>

  <div class="row">
    <button class="btn primary" id="premiumSearch">Cerca</button>
    <button class="btn secondary" id="openTrending">Trending</button>
    <button class="btn secondary" id="homeFromPremium">Home</button>
  </div>
</div>

<div class="card hidden" id="trending">
  <h2>Trending settimanale</h2>
  <div class="row">
    <button class="btn primary" id="trendMovieBtn">Trending Film</button>
    <button class="btn primary" id="trendTvBtn">Trending Serie TV</button>
    <button class="btn secondary" id="homeFromTrending">Home</button>
  </div>
  <div class="results" id="trendBox"></div>
</div>

<div class="card hidden" id="results">
  <h2>Risultati</h2>
  <div class="results" id="resultsBox"></div>
  <div class="row">
    <button class="btn secondary" id="homeFromResults">Home</button>
  </div>
</div>

<script>
const API_KEY="f8ecb75282e8dcea2d4845598cc7d030";
const IMG="https://image.tmdb.org/t/p/w500";
let currentType="movie";

const LS_DATE="mf_basic_date";
const LS_COUNT="mf_basic_count";

const el=(id)=>document.getElementById(id);

function todayKey(){
const d=new Date();
return d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0")+"-"+String(d.getDate()).padStart(2,"0");
}
function getBasicCount(){
const t=todayKey();
const dt=localStorage.getItem(LS_DATE);
if(dt!==t){
localStorage.setItem(LS_DATE,t);
localStorage.setItem(LS_COUNT,"0");
return 0;
}
return parseInt(localStorage.getItem(LS_COUNT)||"0",10);
}
function setBasicCount(n){
localStorage.setItem(LS_DATE,todayKey());
localStorage.setItem(LS_COUNT,String(n));
}

function hideAll(){
["home","basic","premium","trending","results"].forEach(id=>el(id).classList.add("hidden"));
}
function show(id){
hideAll();
el(id).classList.remove("hidden");
window.scrollTo({top:0,behavior:"smooth"});
}

function startExitFade(){
const f=el("fadeOut");
f.classList.remove("show");
requestAnimationFrame(()=>{
requestAnimationFrame(()=>{
f.classList.add("show");
setTimeout(()=>{ try{ window.close(); }catch(e){} }, 900);
});
});
}

el("exitBtn").addEventListener("click", ()=>{ try{ window.close(); }catch(e){} });

function render(container,m,brief){
const div=document.createElement("div");
div.className="result";
div.innerHTML=`
<div class="poster">${m.poster_path?`<img src="${IMG+m.poster_path}" alt="">`:""}</div>
<div>
<h3>${escapeHtml(m.title||m.name||"Titolo")}</h3>
<p class="small">${escapeHtml(m.overview?(brief?m.overview.substring(0,140)+"...":m.overview):"")}</p>
<button class="btn secondary" data-a="watch">Guarda</button>
</div>`;
div.querySelector('[data-a="watch"]').addEventListener("click", startExitFade);
container.appendChild(div);
}

function escapeHtml(s){
return (s||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
}

/* SPLASH: 2 secondi poi mostra HOME */
window.addEventListener("load", ()=>{
hideAll();
el("home").classList.add("hidden");
setTimeout(()=>{
el("splash").classList.add("hide");
show("home");
}, 2000);
});

el("basicGo").addEventListener("click", ()=>show("basic"));
el("premiumGo").addEventListener("click", ()=>show("premium"));

el("homeFromBasic").addEventListener("click", ()=>show("home"));
el("homeFromPremium").addEventListener("click", ()=>show("home"));
el("homeFromTrending").addEventListener("click", ()=>show("home"));
el("homeFromResults").addEventListener("click", ()=>show("home"));

el("typeMovie").addEventListener("click", ()=>{ currentType="movie"; });
el("typeTv").addEventListener("click", ()=>{ currentType="tv"; });

el("openTrending").addEventListener("click", ()=>show("trending"));
el("trendMovieBtn").addEventListener("click", ()=>loadTrending("movie"));
el("trendTvBtn").addEventListener("click", ()=>loadTrending("tv"));

el("basicSearch").addEventListener("click", searchBasic);
el("premiumSearch").addEventListener("click", searchPremium);

async function searchBasic(){
const msg=el("basicMsg");
msg.textContent="";
if(getBasicCount()>=1){
msg.textContent="Hai giÃ  fatto la ricerca di oggi.";
return;
}
show("results");
const box=el("resultsBox");
box.innerHTML="Carico...";

const genres=[...document.querySelectorAll('#basic input[type="checkbox"]:checked')].map(x=>x.value).join(",");
if(!genres){box.innerHTML="Seleziona un genere";return;}

try{
const r=await fetch(`https://api.themoviedb.org/3/discover/movie?api_key=${API_KEY}&language=it-IT&with_genres=${genres}&include_adult=false&sort_by=popularity.desc`);
const d=await r.json();
box.innerHTML="";
const list=(d.results||[]);
if(!list.length){box.innerHTML="Nessun risultato";return;}
list.slice(0,3).forEach(m=>render(box,m,true));
setBasicCount(1);
}catch(e){
box.innerHTML="Errore caricamento";
}
}

async function searchPremium(){
show("results");
const box=el("resultsBox");
box.innerHTML="Carico...";

const sliders=[...document.querySelectorAll('#premium input[type="range"]')]
.filter(r=>parseInt(r.value,10)>0).map(r=>r.dataset.g).join(",");

if(!sliders){box.innerHTML="Alza almeno uno slider";return;}

try{
const r=await fetch(`https://api.themoviedb.org/3/discover/${currentType}?api_key=${API_KEY}&language=it-IT&with_genres=${sliders}&include_adult=true&sort_by=popularity.desc`);
const d=await r.json();
box.innerHTML="";
const list=(d.results||[]);
if(!list.length){box.innerHTML="Nessun risultato";return;}
list.slice(0,5).forEach(m=>render(box,m,false));
}catch(e){
box.innerHTML="Errore caricamento";
}
}

async function loadTrending(type){
const box=el("trendBox");
box.innerHTML="Carico...";
try{
const r=await fetch(`https://api.themoviedb.org/3/trending/${type}/week?api_key=${API_KEY}`);
const d=await r.json();
box.innerHTML="";
const list=(d.results||[]);
if(!list.length){box.innerHTML="Nessun dato";return;}
list.slice(0,5).forEach(m=>render(box,m,false));
}catch(e){
box.innerHTML="Errore trending";
}
}
</script>

</body>
</html>
