<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#1b0b2e" />
  <title>Movie Finder</title>

  <style>
    :root{
      --bg:#0b0612;
      --panel:#120a1f;
      --txt:#f2eefb;
      --muted:#bdb3d6;
      --accent:#b300ff;
      --accent2:#ffe600;
      --danger:#ff4d4d;
      --shadow: 0 18px 50px rgba(0,0,0,.45);
      --radius: 18px;
      --gap: 14px;
      --w: 980px;
      --font: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--font);
      color:var(--txt);
      background:
        radial-gradient(1200px 600px at 20% 10%, rgba(179,0,255,.25), transparent 55%),
        radial-gradient(1100px 700px at 80% 30%, rgba(255,230,0,.12), transparent 60%),
        linear-gradient(180deg, #06030a, var(--bg));
      overflow-x:hidden;
    }
    .wrap{max-width:var(--w); margin:0 auto; padding:22px 16px 48px}
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border:1px solid rgba(255,255,255,.08);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      backdrop-filter: blur(10px);
    }
    .row{display:flex; gap:var(--gap); flex-wrap:wrap}
    .col{flex:1 1 340px; min-width:320px}
    .header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:18px;
    }
    .brand{display:flex; align-items:center; gap:12px}
    .logo{
      width:52px;height:52px;border-radius:16px;
      background:
        radial-gradient(20px 20px at 35% 30%, rgba(255,230,0,.9), transparent 60%),
        radial-gradient(30px 30px at 70% 70%, rgba(179,0,255,.9), transparent 60%),
        linear-gradient(135deg, rgba(179,0,255,.75), rgba(255,230,0,.35));
      border:1px solid rgba(255,255,255,.18);
      position:relative;
      overflow:hidden;
    }
    .logo:before{
      content:"";
      position:absolute;
      inset:10px 12px 14px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.22);
      transform:skewX(-6deg);
    }
    .title{display:flex; flex-direction:column; line-height:1.1}
    .title h1{margin:0; font-size:20px}
    .title p{margin:3px 0 0; color:var(--muted); font-size:13px}
    .topActions{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .btn{
      border:0;
      border-radius:16px;
      padding:12px 14px;
      font-weight:700;
      cursor:pointer;
      color:var(--txt);
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.10);
    }
    .btn:active{transform:translateY(1px)}
    .btnPrimary{
      background:linear-gradient(135deg, rgba(179,0,255,.90), rgba(179,0,255,.45));
      border:1px solid rgba(179,0,255,.55);
    }
    .btnSecondary{
      background:linear-gradient(135deg, rgba(255,230,0,.85), rgba(255,230,0,.35));
      border:1px solid rgba(255,230,0,.55);
      color:#1a1026;
    }
    .btnDanger{
      background:rgba(255,77,77,.14);
      border:1px solid rgba(255,77,77,.35);
    }
    .section{padding:16px}
    .section h2{margin:0 0 10px; font-size:16px}
    .muted{color:var(--muted); font-size:13px; margin:0}
    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:8px 10px;
      border-radius:999px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      font-size:12px;
      color:var(--muted);
      user-select:none;
    }
    .grid{
      display:grid;
      grid-template-columns:repeat(12,1fr);
      gap:var(--gap);
      padding:16px;
    }
    .panel{grid-column:span 12; padding:16px}
    @media(min-width:900px){
      .panelLeft{grid-column:span 5}
      .panelRight{grid-column:span 7}
    }
    .divider{height:1px; background:rgba(255,255,255,.08); margin:14px 0}
    .stack{display:flex; flex-direction:column; gap:12px}
    .field{display:flex; flex-direction:column; gap:6px}
    .field label{font-size:12px; color:var(--muted)}
    input, select{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.28);
      color:var(--txt);
      outline:none;
    }
    .chips{display:flex; flex-wrap:wrap; gap:10px}
    .chip{
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.06);
      cursor:pointer;
      user-select:none;
      font-weight:700;
      font-size:13px;
      color:var(--txt);
    }
    .chip[aria-pressed="true"]{
      border-color:rgba(179,0,255,.65);
      background:rgba(179,0,255,.18);
    }
    .sliderRow{display:flex; gap:10px; align-items:center}
    .sliderRow input[type="range"]{flex:1}
    .valBox{
      min-width:44px;
      text-align:center;
      padding:9px 10px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.06);
      font-weight:800;
    }
    .results{display:flex; flex-direction:column; gap:12px}
    .result{
      display:flex; gap:12px;
      padding:12px;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.22);
    }
    .poster{
      width:72px; height:108px;
      border-radius:14px;
      background:linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
      border:1px solid rgba(255,255,255,.12);
      flex:0 0 auto;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:11px;
      color:var(--muted);
      overflow:hidden;
    }
    .meta{flex:1}
    .meta h3{margin:0; font-size:14px}
    .meta .sub{margin:5px 0 0; font-size:12px; color:var(--muted)}
    .meta .plot{margin:8px 0 0; font-size:13px; line-height:1.25}
    .tags{display:flex; flex-wrap:wrap; gap:8px; margin-top:8px}
    .tag{
      padding:6px 8px;
      border-radius:999px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      font-size:11px;
      color:var(--muted);
    }
    .toast{
      position:fixed;
      left:50%;
      bottom:18px;
      transform:translateX(-50%);
      padding:12px 14px;
      border-radius:999px;
      background:rgba(0,0,0,.65);
      border:1px solid rgba(255,255,255,.10);
      color:var(--txt);
      font-size:13px;
      opacity:0;
      pointer-events:none;
      transition:opacity .2s ease;
      max-width:min(92vw,700px);
      text-align:center;
    }
    .toast.show{opacity:1}
    .hidden{display:none !important}
    .right{display:flex; justify-content:flex-end; gap:10px; flex-wrap:wrap}
    .small{font-size:12px; color:var(--muted)}
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card header">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div class="title">
          <h1>Movie Finder</h1>
          <p>Trova film e serie in base ai tuoi gusti</p>
        </div>
      </div>
      <div class="topActions">
        <span id="modePill" class="pill">Modalità: Home</span>
        <button class="btn btnDanger" id="btnExitTop">Esci</button>
      </div>
    </div>

    <div id="viewHome" class="card section" style="margin-top:14px;">
      <h2>Scegli il profilo</h2>
      <p class="muted">Basic per una scelta rapida. Premium per controllo totale e serie TV.</p>
      <div class="divider"></div>
      <div class="row">
        <div class="col card section" style="background:rgba(0,0,0,.18); border:1px solid rgba(255,255,255,.08);">
          <h2>Basic</h2>
          <p class="muted">Solo film. 4 generi. 1 ricerca al giorno. 3 risultati. Trama breve.</p>
          <div class="divider"></div>
          <div class="right">
            <button class="btn btnPrimary" id="btnEnterBasic">Entra in Basic</button>
          </div>
        </div>

        <div class="col card section" style="background:rgba(0,0,0,.18); border:1px solid rgba(255,255,255,.08);">
          <h2>Premium</h2>
          <p class="muted">Film e serie TV. Slider intensità. Ricerche illimitate. 5 risultati. Trama completa. Watchlist.</p>
          <div class="divider"></div>
          <div class="right">
            <button class="btn btnSecondary" id="btnEnterPremium">Entra in Premium</button>
          </div>
          <p class="small" id="premiumStatusLine" style="margin-top:10px;"></p>
        </div>
      </div>
    </div>

    <div id="viewBasic" class="card hidden" style="margin-top:14px;">
      <div class="grid">
        <div class="panel panelLeft card" style="background:rgba(0,0,0,.18);">
          <h2>Basic, genera suggerimenti</h2>
          <p class="muted">Seleziona i generi. Poi cerca. Una volta al giorno.</p>
          <div class="divider"></div>

          <div class="stack">
            <div class="field">
              <label>Tipo contenuto</label>
              <select disabled><option>Film</option></select>
              <p class="small">Serie TV disabilitate in Basic.</p>
            </div>

            <div class="field">
              <label>Generi</label>
              <div class="chips" id="basicGenres">
                <button class="chip" data-genre="Azione" aria-pressed="false">Azione</button>
                <button class="chip" data-genre="Comico" aria-pressed="false">Comico</button>
                <button class="chip" data-genre="Thriller" aria-pressed="false">Thriller</button>
                <button class="chip" data-genre="Animazione" aria-pressed="false">Animazione</button>
              </div>
              <p class="small">Seleziona 1 o più generi.</p>
            </div>

            <div class="right">
              <button class="btn btnPrimary" id="btnBasicSearch">Cerca</button>
              <button class="btn" id="btnBasicBack">Torna alla Home</button>
            </div>

            <p class="small" id="basicLimitInfo"></p>
          </div>
        </div>

        <div class="panel panelRight card" style="background:rgba(0,0,0,.18);">
          <h2>Risultati</h2>
          <p class="muted">3 proposte. Trama breve.</p>
          <div class="divider"></div>
          <div class="results" id="basicResults"></div>
        </div>
      </div>
    </div>

    <div id="viewPremiumLogin" class="card hidden" style="margin-top:14px;">
      <div class="grid">
        <div class="panel panelLeft card" style="background:rgba(0,0,0,.18);">
          <h2>Premium, login</h2>
          <p class="muted">Accedi per usare le funzioni Premium.</p>
          <div class="divider"></div>

          <div class="stack">
            <div class="field">
              <label>Email</label>
              <input id="premiumEmail" type="email" autocomplete="username" value="maprexx@gmail.com" />
            </div>
            <div class="field">
              <label>Password</label>
              <input id="premiumPass" type="password" autocomplete="current-password" value="Max2025Aa@@@@@" />
            </div>

            <div class="right">
              <button class="btn btnSecondary" id="btnPremiumLogin">Accedi</button>
              <button class="btn" id="btnPremiumBackHome">Torna alla Home</button>
            </div>

            <p class="small">In release, non salvare password in chiaro. Usa token di sessione.</p>
          </div>
        </div>

        <div class="panel panelRight card" style="background:rgba(0,0,0,.18);">
          <h2>Premium</h2>
          <p class="muted">Se non hai Premium attivo, la app deve riportarti al paywall.</p>
          <div class="divider"></div>
          <div class="stack">
            <span class="pill">Controllo Premium prima del login</span>
            <span class="pill">Controllo Premium anche dopo il login</span>
          </div>
        </div>
      </div>
    </div>

    <div id="viewPremium" class="card hidden" style="margin-top:14px;">
      <div class="grid">
        <div class="panel panelLeft card" style="background:rgba(0,0,0,.18);">
          <h2>Premium, preferenze</h2>
          <p class="muted">Scegli film o serie TV. Regola i generi con slider.</p>
          <div class="divider"></div>

          <div class="stack">
            <div class="field">
              <label>Tipo contenuto</label>
              <select id="premiumType">
                <option value="movie">Film</option>
                <option value="tv">Serie TV</option>
              </select>
            </div>

            <div class="field">
              <label>Generi e intensità</label>
              <div class="stack" id="premiumSliders"></div>
              <p class="small">0 disattivo. 5 massimo.</p>
            </div>

            <div class="right">
              <button class="btn btnSecondary" id="btnPremiumSearch">Cerca</button>
              <button class="btn" id="btnPremiumLogout">Logout</button>
            </div>

            <div class="divider"></div>
            <span class="pill" id="premiumSessionPill">Sessione: non attiva</span>
          </div>
        </div>

        <div class="panel panelRight card" style="background:rgba(0,0,0,.18);">
          <h2>Risultati</h2>
          <p class="muted">5 proposte. Trama completa. Statistiche. Piattaforme.</p>
          <div class="divider"></div>
          <div class="results" id="premiumResults"></div>
        </div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    "use strict";

    const $ = (sel) => document.querySelector(sel);

    const views = {
      home: $("#viewHome"),
      basic: $("#viewBasic"),
      premiumLogin: $("#viewPremiumLogin"),
      premium: $("#viewPremium"),
    };

    const modePill = $("#modePill");
    const toast = $("#toast");

    let toastTimer = null;
    function showToast(msg){
      toast.textContent = msg;
      toast.classList.add("show");
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => toast.classList.remove("show"), 2200);
    }

    function showView(name){
      Object.values(views).forEach(v => v.classList.add("hidden"));
      views[name].classList.remove("hidden");
      const label = ({home:"Home",basic:"Basic",premiumLogin:"Premium login",premium:"Premium"})[name] || "Home";
      modePill.textContent = "Modalità: " + label;
      window.scrollTo({top:0, behavior:"smooth"});
    }

    function dayKey(){
      const d = new Date();
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth()+1).padStart(2,"0");
      const dd = String(d.getDate()).padStart(2,"0");
      return `${yyyy}-${mm}-${dd}`;
    }

    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

    function shortenBasicPlot(text){
      const maxChars = 200;
      const clean = String(text || "").replace(/\s+/g," ").trim();
      if(clean.length <= maxChars) return clean;
      return clean.slice(0, maxChars - 1).trimEnd() + "…";
    }

    const demoCatalog = [
      {id:"m1", type:"movie", title:"Fuga di Mezzanotte", year:2023, vote:7.7, runtime:118, genres:["Azione","Thriller"], platforms:["Netflix","Prime Video"], plotLong:"Un uomo finisce in un giro pericoloso e deve scegliere in fretta chi fidarsi. Insegue indizi tra città e periferie, mentre ogni errore costa caro. La tensione cresce e le scelte diventano sempre più difficili."},
      {id:"m2", type:"movie", title:"Risate a Catena", year:2021, vote:7.1, runtime:104, genres:["Comico"], platforms:["Netflix"], plotLong:"Una serie di equivoci trascina un gruppo di amici in situazioni sempre più assurde. Il ritmo resta alto e ogni decisione peggiora il caos. Alla fine devono sistemare tutto senza perdere la faccia."},
      {id:"m3", type:"movie", title:"Ombre sul Porto", year:2019, vote:7.4, runtime:112, genres:["Thriller"], platforms:["Prime Video"], plotLong:"Un’indagine porta a galla segreti che nessuno vuole nominare. La città cambia volto di notte e i testimoni spariscono. Il protagonista segue una pista che lo mette contro persone potenti."},
      {id:"m4", type:"movie", title:"Linea Animata", year:2022, vote:7.6, runtime:96, genres:["Animazione","Comico"], platforms:["Disney+"], plotLong:"Un personaggio animato scopre di poter cambiare le regole del suo mondo. Prova a migliorare le cose, ma ogni modifica crea effetti imprevisti. Impara a gestire responsabilità e limiti senza perdere leggerezza."},
      {id:"m5", type:"movie", title:"Collisione", year:2024, vote:7.9, runtime:121, genres:["Azione"], platforms:["Prime Video","Apple TV"], plotLong:"Un evento improvviso rompe la routine e costringe a reagire. Il protagonista affronta ostacoli concreti, corse contro il tempo e un avversario difficile da leggere. L’azione spinge la storia fino a un punto di svolta."},
      {id:"t1", type:"tv", title:"Città Doppia", year:2023, vote:8.0, runtime:52, genres:["Thriller","Dramma"], platforms:["Netflix"], plotLong:"Una serie segue due vite che si incrociano senza saperlo. Ogni episodio aggiunge un tassello e cambia il significato delle scelte precedenti. Le relazioni diventano il centro del conflitto."},
      {id:"t2", type:"tv", title:"Cuori in Salita", year:2022, vote:7.5, runtime:45, genres:["Romantico","Comico"], platforms:["Prime Video"], plotLong:"Due persone molto diverse cercano di far funzionare una relazione in mezzo a impegni e ostacoli reali. Il tono resta leggero ma tocca temi concreti. La serie costruisce crescita e complicità episodio dopo episodio."},
      {id:"t3", type:"tv", title:"Reparto 7", year:2021, vote:7.8, runtime:50, genres:["Azione","Thriller"], platforms:["Disney+"], plotLong:"Una squadra affronta missioni ad alto rischio e conseguenze personali. Ogni scelta tecnica ha un prezzo umano. Il ritmo resta alto e la trama costruisce tensione progressiva."},
    ];

    function scoreItem(item, type, weights){
      if(item.type !== type) return -9999;
      let s = 0;
      for(const g of item.genres){ s += (weights[g] || 0); }
      s += (item.year >= 2018 ? 0.35 : 0);
      s += (item.year >= 2022 ? 0.35 : 0);
      s += (item.vote / 10) * 0.6;
      return s;
    }

    function pickTop(items, type, weights, n){
      const scored = items
        .map(it => ({it, s: scoreItem(it, type, weights)}))
        .sort((a,b) => b.s - a.s);

      const picked = [];
      const used = new Set();
      for(const x of scored){
        if(picked.length >= n) break;
        if(x.s < -1000) continue;
        if(used.has(x.it.id)) continue;
        used.add(x.it.id);
        picked.push(x.it);
      }
      return picked;
    }

    function renderResult(container, item, isPremium){
      const el = document.createElement("div");
      el.className = "result";

      const poster = document.createElement("div");
      poster.className = "poster";
      poster.textContent = "Poster";

      const meta = document.createElement("div");
      meta.className = "meta";

      const h = document.createElement("h3");
      h.textContent = `${item.title} (${item.year})`;

      const sub = document.createElement("div");
      sub.className = "sub";
      const typeLabel = item.type === "tv" ? "Serie TV" : "Film";
      sub.textContent = `${typeLabel} · Voto ${item.vote.toFixed(1)} · Durata ${item.runtime} min`;

      const plot = document.createElement("div");
      plot.className = "plot";
      plot.textContent = isPremium ? item.plotLong : shortenBasicPlot(item.plotLong);

      const tags = document.createElement("div");
      tags.className = "tags";

      const gTag = document.createElement("div");
      gTag.className = "tag";
      gTag.textContent = item.genres.join(", ");

      const pTag = document.createElement("div");
      pTag.className = "tag";
      pTag.textContent = "Piattaforme: " + item.platforms.join(", ");

      tags.appendChild(gTag);
      tags.appendChild(pTag);

      meta.appendChild(h);
      meta.appendChild(sub);
      meta.appendChild(plot);
      meta.appendChild(tags);

      el.appendChild(poster);
      el.appendChild(meta);

      container.appendChild(el);
    }

    const state = {
      basicSearchDoneOn: "",
      basicGenres: new Set(),
      premiumWeights: {"Azione":0,"Comico":0,"Thriller":0,"Animazione":0,"Romantico":0,"Dramma":0},
      premiumSession: false
    };

    function updateBasicLimitInfo(){
      const today = dayKey();
      const info = $("#basicLimitInfo");
      if(state.basicSearchDoneOn === today){
        info.textContent = "Hai già fatto la ricerca di oggi. Riprova domani.";
      }else{
        info.textContent = "Ricerca disponibile oggi.";
      }
    }

    function toggleChip(btn, setRef){
      const g = btn.getAttribute("data-genre");
      const pressed = btn.getAttribute("aria-pressed") === "true";
      btn.setAttribute("aria-pressed", String(!pressed));
      if(pressed) setRef.delete(g); else setRef.add(g);
    }

    function buildPremiumSliders(){
      const box = $("#premiumSliders");
      box.innerHTML = "";
      const genres = ["Azione","Comico","Thriller","Animazione","Romantico","Dramma"];
      for(const g of genres){
        const row = document.createElement("div");
        row.className = "field";

        const label = document.createElement("label");
        label.textContent = g;

        const srow = document.createElement("div");
        srow.className = "sliderRow";

        const range = document.createElement("input");
        range.type = "range";
        range.min = "0";
        range.max = "5";
        range.step = "1";
        range.value = String(state.premiumWeights[g] || 0);

        const val = document.createElement("div");
        val.className = "valBox";
        val.textContent = String(range.value);

        range.addEventListener("input", () => {
          const v = clamp(parseInt(range.value,10) || 0, 0, 5);
          range.value = String(v);
          val.textContent = String(v);
          state.premiumWeights[g] = v;
        });

        srow.appendChild(range);
        srow.appendChild(val);

        row.appendChild(label);
        row.appendChild(srow);

        box.appendChild(row);
      }
    }

    function androidAvailable(){
      return typeof window.Android !== "undefined"
        && typeof window.Android.requestPremium === "function"
        && typeof window.Android.isPremium === "function";
    }

    function requestPremium(){
      if(androidAvailable()){
        window.Android.requestPremium();
      }else{
        showToast("Premium disponibile solo in app Android");
      }
    }

    function refreshPremiumStatus(){
      const line = $("#premiumStatusLine");
      if(!androidAvailable()){
        line.textContent = "";
        return;
      }
      const ok = window.Android.isPremium();
      line.textContent = ok ? "Premium attivo" : "Premium non attivo";
    }

    function openPremium(){
      state.premiumSession = true;
      $("#premiumSessionPill").textContent = "Sessione: attiva";
      showView("premium");
    }

    function openPremiumLogin(){
      showView("premiumLogin");
    }

    function goHome(){
      showView("home");
      refreshPremiumStatus();
    }

    function exitApp(){
      if(typeof window.Android !== "undefined" && typeof window.Android.exitApp === "function"){
        window.Android.exitApp();
      }else{
        showToast("Chiusura non disponibile qui");
      }
    }

    window.App = {
      openPremium,
      openPremiumLogin,
      goHome,
      showToast
    };

    $("#btnExitTop").addEventListener("click", exitApp);

    $("#btnEnterBasic").addEventListener("click", () => {
      updateBasicLimitInfo();
      showView("basic");
    });

    $("#btnEnterPremium").addEventListener("click", () => {
      requestPremium();
    });

    $("#btnBasicBack").addEventListener("click", goHome);

    $("#basicGenres").addEventListener("click", (e) => {
      const btn = e.target.closest(".chip");
      if(!btn) return;
      toggleChip(btn, state.basicGenres);
    });

    $("#btnBasicSearch").addEventListener("click", () => {
      const today = dayKey();
      updateBasicLimitInfo();
      if(state.basicSearchDoneOn === today){
        showToast("Limite giornaliero raggiunto");
        return;
      }
      if(state.basicGenres.size === 0){
        showToast("Seleziona almeno un genere");
        return;
      }

      const weights = {};
      for(const g of state.basicGenres) weights[g] = 5;

      const picked = pickTop(demoCatalog, "movie", weights, 3);
      const box = $("#basicResults");
      box.innerHTML = "";
      if(picked.length === 0){
        box.textContent = "Nessun risultato.";
        return;
      }
      picked.forEach(it => renderResult(box, it, false));

      state.basicSearchDoneOn = today;
      updateBasicLimitInfo();
      showToast("Risultati aggiornati");
    });

    $("#btnPremiumBackHome").addEventListener("click", goHome);

    $("#btnPremiumLogin").addEventListener("click", () => {
      if(androidAvailable() && !window.Android.isPremium()){
        showToast("Premium non attivo");
        goHome();
        return;
      }
      const email = $("#premiumEmail").value.trim();
      const pass = $("#premiumPass").value;
      if(email.length < 6 || pass.length < 6){
        showToast("Credenziali non valide");
        return;
      }
      openPremium();
      showToast("Login ok");
    });

    $("#btnPremiumLogout").addEventListener("click", () => {
      state.premiumSession = false;
      $("#premiumSessionPill").textContent = "Sessione: non attiva";
      $("#premiumResults").innerHTML = "";
      showToast("Logout");
      goHome();
    });

    buildPremiumSliders();

    $("#btnPremiumSearch").addEventListener("click", () => {
      if(androidAvailable() && !window.Android.isPremium()){
        showToast("Premium non attivo");
        goHome();
        return;
      }
      if(!state.premiumSession){
        showToast("Fai login");
        showView("premiumLogin");
        return;
      }

      const type = $("#premiumType").value;

      let sum = 0;
      for(const v of Object.values(state.premiumWeights)) sum += v;
      if(sum === 0){
        showToast("Alza almeno uno slider");
        return;
      }

      const picked = pickTop(demoCatalog, type, state.premiumWeights, 5);
      const box = $("#premiumResults");
      box.innerHTML = "";
      if(picked.length === 0){
        box.textContent = "Nessun risultato.";
        return;
      }
      picked.forEach(it => renderResult(box, it, true));
      showToast("Risultati aggiornati");
    });

    showView("home");
    refreshPremiumStatus();
    updateBasicLimitInfo();
  </script>
</body>
</html>
